<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="welfare.system.mapper.ArticleClassificationMapper">

    <delete id="deleteAllClassify">
        DELETE FROM `article_classification`
        WHERE id IN
        <foreach collection="idList" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    
    <update id="updateAllCausedByProjectChange">
        UPDATE `train_resource` SET `status`=1,`project_id`=-1,`period_id`=-1 WHERE `project_id` IN
        <foreach collection="idList" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>;

        UPDATE `achievement` SET `status`=2,`project_id`=-1,`period_id`=-1 WHERE `project_id` IN
        <foreach collection="idList" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>;

        UPDATE `activity` SET `status`=1,`project_id`=-1 WHERE `project_id` IN
        <foreach collection="idList" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>;
    </update>

    <update id="updateOneCausedByProjectChange">
        UPDATE `train_resource` SET `status`=1,`project_id`=-1,`period_id`=-1 WHERE `project_id`=#{id};
        UPDATE `achievement` SET `status`=2,`project_id`=-1,`period_id`=-1 WHERE `project_id`=#{id};
        UPDATE `activity` SET `status`=1,`project_id`=-1 WHERE `project_id`=#{id};
    </update>

    <update id="updateOneCausedByPeriodChange">
        UPDATE `train_resource` SET `period_id`=0 WHERE `period_id`=#{id};
        UPDATE `achievement` SET `period_id`=0 WHERE `period_id`=#{id};
    </update>

    <!--检查整个列表的id正确性-->
<!--    <select id="checkClassifyListType">-->
<!--        SELECT NOT EXISTS(-->
<!--            SELECT 1-->
<!--            FROM `article_classification`-->
<!--            WHERE `id` IN-->
<!--            <foreach collection="idList" item="id" open="(" separator="," close=")">-->
<!--                #{id}-->
<!--            </foreach>-->
<!--            AND `classify_type`!=#{classifyType}-->
<!--            LIMIT 1-->
<!--        )-->
<!--    </select>-->

    <!-- 根据 id 列表获取分类 -->
    <select id="getClassifyByIdList">
        SELECT A.*, B.file_name AS coverURL
        FROM article_classification A
        LEFT JOIN file_resource B ON A.classify_cover = B.id
        WHERE A.id IN
        <foreach item="id" collection="idList" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

</mapper>