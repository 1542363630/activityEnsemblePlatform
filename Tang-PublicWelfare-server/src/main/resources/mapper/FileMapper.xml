<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="welfare.system.mapper.FileMapper">
    
    <!--批量插入文件引用情况-->
    <insert id="recordFileQuote">
        INSERT INTO `file_quote`(`article_id`,`file_id`)
        VALUES
        <foreach collection="fileIdList" separator="," item="fileId">
            (#{articleId},#{fileId})
        </foreach>;

        UPDATE `file_resource` SET `status`=0 WHERE `id` IN
        <foreach collection="fileIdList" item="fileId" open="(" separator="," close=")">
            #{fileId}
        </foreach>;
    </insert>

    <!-- 根据文章查找文件引用情况 -->
    <select id="getFileIdByArticleId" resultType="Integer">
        SELECT `file_id`
        FROM `file_quote`
        WHERE `article_id` = #{articleId};
    </select>
    
</mapper>